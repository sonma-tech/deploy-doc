部署流程(Deployment)
====================

::

    Database->Redis->ECS->Clusters->SLB->Deploy->Monitor

准备
----------

1. 根据使用场景选择可用区，为了保障服务的高可用性，多台ECS尽可能选择不同的可用区，防止区域性ECS故障对服务造成影响。
2. 创建VPC网络，Redis、Mysql等基础服务和ECS需要部署在同一个网段内。
3. 创建创建安全组。

创建Mysql实例
----------------
1. 选择指定可用区、VPC网络、实例配置进行创建。
2. 将ECS所在的内网网段加入数据库白名单中。
3. 创建应用中需要用到的数据库账号，并给定相应的读写权限。


创建Redis实例
----------------
1. 选择指定可用区、VPC网络、实例配置进行创建。
2. 记录下Redis密码。
3. 将ECS所在的内网网段加入Redis白名单中。


创建ECS实例
----------------
选择指定可用区、VPC网络、安全组、实例配置进行创建。


创建负载均衡实例
----------------
选择指定可用区、实例配置进行创建。


创建集群
----------------
1. 在阿里云容器服务中，创建集群，将之前创建的ECS实例添加到集群中，作为初始节点。
2. 在集群配置中设置伸缩规则，内存使用率小于40%时缩容大于75%时扩容。


在集群中部署应用
----------------
在阿里云容器服务中创建应用并部署

1. 在阿里云容器服务中创建私有镜像仓库
2. 将构建好的镜像推送到私有镜像仓库
3. 选择私有的应用镜像,在指定服务器集群中创建对应的应用
4. 创建应用时需要使用正确的参数进行编排
5. 部署并启动应用

.. important::
    需要创建子账号用于镜像交付，镜像编排请参照 :ref:`启动参数 <cmd_config>`

应用监控
----------------
在容器服务中，监控各集群各节点各容器的运行状态，设置报警阀值。


绑定负载均衡
----------------
应用部署成功后，需要在阿里云容器服务中，将集群和对应的SLB进行绑定，并设置端口健康检查参数。


至此服务端部署就绪